<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - Fatos da Bolsa</title>
    
    <!-- CSS Moderno -->
    <link rel="stylesheet" href="/admin-modern.css">
    
    <style>
        /* Estilos adicionais para padronizar com index.html */
        .login-container {
            background: linear-gradient(180deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .login-box {
            background: #ffffff;
            border-radius: 24px;
            box-shadow: 0 24px 60px rgba(15, 23, 42, 0.12);
            border: 1px solid #e2e8f0;
            max-width: 460px;
            width: 100%;
            padding: 40px 44px;
        }

        .login-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        .brand-logo {
            max-width: 112px;
            width: 100%;
            height: auto;
            display: block;
        }

        .login-eyebrow {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: #94a3b8;
        }

        .login-box h1 {
            color: #0f172a;
            font-size: 26px;
            font-weight: 700;
            margin: 0;
        }

        .login-subtitle {
            color: #475569;
            font-size: 15px;
            margin-top: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #0f172a;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            font-family: inherit;
            background: #f8fafc;
            color: #0f172a;
        }

        .form-group input::placeholder {
            color: #94a3b8;
        }

        .form-group input:focus {
            outline: none;
            border-color: #1f2937;
            box-shadow: 0 0 0 4px rgba(17, 24, 39, 0.12);
            background: #ffffff;
        }

        .btn-primary {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
            margin-top: 8px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 14px 24px rgba(15, 23, 42, 0.18);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .alert {
            padding: 14px 18px;
            border-radius: 14px;
            margin-bottom: 20px;
            display: none;
            font-size: 14px;
            font-weight: 500;
        }

        .alert.show {
            display: block;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.18);
            color: #7f1d1d;
            border: 1px solid rgba(239, 68, 68, 0.35);
        }

        /* Logo no header do dashboard */
        .header .brand-logo-dashboard {
            max-width: 80px;
            height: auto;
            margin-right: 20px;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        @media (max-width: 520px) {
            .login-box {
                padding: 32px 28px;
            }

            .brand-logo {
                max-width: 92px;
            }
        }
    </style>
</head>
<body>
    <!-- Login -->
    <div id="loginContainer" class="login-container">
        <div class="login-box">
            <div class="login-header">
                <img src="/assets/logo.svg" alt="Logotipo Fatos da Bolsa" class="brand-logo" />
                <div class="login-eyebrow">Área Administrativa</div>
                <h1>Painel de Controle</h1>
                <p class="login-subtitle">Faça login para acessar o sistema</p>
            </div>
            
            <div id="loginAlert" class="alert alert-error"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label>👤 Usuário</label>
                    <input type="text" id="username" placeholder="Digite seu usuário" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>🔒 Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary">Entrar no Painel</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="dashboard-surface">
            <div class="container">
                <div class="header">
                    <div class="header-info">
                        <img src="/assets/logo.svg" alt="Fatos da Bolsa" class="brand-logo-dashboard" />
                        <div>
                            <span class="header-eyebrow">Central de Controle</span>
                            <h1>Dashboard</h1>
                            <p>Escolha a área que deseja gerenciar</p>
                        </div>
                    </div>
                    <div class="header-user">
                        <div class="header-user-meta">
                            <span class="header-user-label">Logado como</span>
                            <span class="header-user-name" id="loggedUser">Admin</span>
                        </div>
                        <button class="header-logout" onclick="logout()">Sair</button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total de Assinantes</h3>
                        <div class="number" id="totalSubscribers">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Usuários Autorizados</h3>
                        <div class="number" id="totalAuthorized">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total de Canais</h3>
                        <div class="number" id="totalChannels">0</div>
                    </div>
                </div>

                <div class="action-banner">
                    <div class="action-banner-content">
                        <div class="action-banner-text">
                            <span class="action-banner-eyebrow">Sincronização inteligente</span>
                            <h3>Atualize automaticamente seus grupos</h3>
                            <p>Garanta que apenas clientes ativos permaneçam com acesso aos canais do Telegram.</p>
                        </div>
                        <button class="btn btn-primary action-banner-button" onclick="syncUsers()" id="syncBtn">
                            🔄 Sincronizar Agora
                        </button>
                    </div>
                    <div id="syncAlert" class="alert"></div>
                </div>

                <div class="tabs">
                    <button class="tab active" data-tab="subscribers" onclick="showTab('subscribers', this)">Assinantes</button>
                    <button class="tab" data-tab="channels" onclick="showTab('channels', this)">Canais</button>
                    <button class="tab" data-tab="admins" onclick="showTab('admins', this)">Administradores</button>
                    <button class="tab" data-tab="logs" onclick="showTab('logs', this)">Logs</button>
                </div>

            <!-- Tab: Assinantes -->
            <div id="subscribersTab" class="tab-content active">
                <div class="card">
                    <h2>
                        Assinantes
                        <div class="card-actions">
                            <div class="search-box">
                                <span class="search-icon" aria-hidden="true">🔍</span>
                                <input type="search" id="subscriberSearch" placeholder="Buscar assinante..." aria-label="Buscar assinante">
                            </div>
                            <button class="btn btn-success btn-small" onclick="openAddSubscriberModal()">+ Novo Assinante</button>
                            <button class="btn btn-small" onclick="openImportModal()">📂 Importar CSV</button>
                            <button class="btn btn-small" onclick="downloadTemplate()">⬇️ Baixar Modelo</button>
                        </div>
                    </h2>
                    <div id="subscribersTable" class="table-container"></div>
                </div>
            </div>

            <!-- Tab: Canais -->
            <div id="channelsTab" class="tab-content">
                <div class="card">
                    <h2>Enviar mensagem para canais</h2>
                    <div id="broadcastAlert" class="alert"></div>
                    <form id="broadcastForm" class="stacked-form">
                        <div class="form-group">
                            <label>Selecione os canais</label>
                            <div class="checkbox-actions">
                                <div class="button-group">
                                    <button type="button" class="btn btn-small" id="broadcastSelectAll">Selecionar todos</button>
                                    <button type="button" class="btn btn-small btn-secondary" id="broadcastClear">Limpar seleção</button>
                                </div>
                                <span id="broadcastSelectedCount" class="selected-count">Nenhum canal ativo disponível</span>
                            </div>
                            <div class="checkbox-list" id="broadcastChannelList"></div>
                        </div>

                        <div class="form-group">
                            <label>Mensagem</label>
                            <textarea id="broadcastMessage" rows="4" placeholder="Escreva a mensagem que será enviada"></textarea>
                            <p class="form-hint">Emojis são suportados normalmente. A mensagem pode ficar em branco caso você envie apenas uma imagem.</p>
                        </div>

                        <div class="form-group">
                            <label>Imagem (opcional)</label>
                            <input type="file" id="broadcastMedia" accept="image/*">
                            <p class="form-hint">Formatos aceitos: JPG, PNG, GIF ou WEBP com até 7&nbsp;MB.</p>
                        </div>

                        <div class="form-group">
                            <label>Formato</label>
                            <select id="broadcastParseMode">
                                <option value="">Texto simples</option>
                                <option value="HTML">HTML</option>
                                <option value="MarkdownV2">Markdown V2</option>
                                <option value="Markdown">Markdown (legado)</option>
                            </select>
                            <p class="form-hint">Para negrito use <code>&lt;b&gt;texto&lt;/b&gt;</code> no modo HTML ou <code>*texto*</code> (um único asterisco em cada lado) nos modos Markdown.</p>
                        </div>

                        <div class="form-group inline">
                            <label>
                                <input type="checkbox" id="broadcastDisableNotification">
                                Enviar sem notificação (silencioso)
                            </label>
                        </div>

                        <div class="button-row">
                            <button type="submit" class="btn btn-primary" id="broadcastSubmit">Enviar mensagem</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <h2>
                        Canais
                        <button class="btn btn-success btn-small" onclick="openAddChannelModal()">+ Novo Canal</button>
                    </h2>
                    <div id="channelsTable" class="table-container"></div>
                </div>
            </div>

            <!-- Tab: Administradores -->
            <div id="adminsTab" class="tab-content">
                <div class="card">
                    <h2>
                        Administradores
                        <button class="btn btn-success btn-small" onclick="openAddAdminModal()">+ Novo Administrador</button>
                    </h2>
                    <div id="adminsAlert" class="alert"></div>
                    <div id="adminsTable" class="table-container"></div>
                </div>
            </div>

            <!-- Tab: Logs -->
            <div id="logsTab" class="tab-content">
                <div class="card">
                    <h2>Histórico de Autorizações</h2>
                    <div id="logsTable" class="table-container"></div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Modal: Adicionar/Editar Assinante -->
    <div id="subscriberModal" class="modal">
        <div class="modal-content">
            <h2 id="subscriberModalTitle">Novo Assinante</h2>
            <div id="subscriberModalAlert" class="alert"></div>
            <form id="subscriberForm">
                <input type="hidden" id="subscriberId">
                <div class="form-group">
                    <label>Nome</label>
                    <input type="text" id="subscriberName" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="subscriberEmail" required>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="subscriberPhone" placeholder="11999999999" required>
                </div>
                <div class="form-group">
                    <label>Plano</label>
                    <select id="subscriberPlan" required>
                        <option value="">Selecione...</option>
                        <option value="CF VIP - FATOS DA BOLSA 1">CF VIP - FATOS DA BOLSA 1</option>
                        <option value="CF VIP - FATOS DA BOLSA 2">CF VIP - FATOS DA BOLSA 2</option>
                        <option value="CF VIP - FATOS DA BOLSA 3">CF VIP - FATOS DA BOLSA 3</option>
                        <option value="Close Friends LITE">Close Friends LITE</option>
                        <option value="Projeto Renda Passiva">Projeto Renda Passiva</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="subscriberStatus">
                        <option value="active">Ativo</option>
                        <option value="inactive">Inativo</option>
                    </select>
                </div>
                <div class="button-row">
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeSubscriberModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Adicionar/Editar Canal -->
    <div id="channelModal" class="modal">
        <div class="modal-content">
            <h2 id="channelModalTitle">Novo Canal</h2>
            <div id="channelModalAlert" class="alert"></div>
            <form id="channelForm">
                <input type="hidden" id="channelId">
                <div class="form-group">
                    <label>Nome do Canal</label>
                    <input type="text" id="channelName" required>
                </div>
                <div class="form-group">
                    <label>Chat ID</label>
                    <input type="text" id="channelChatId" placeholder="-1001234567890" required>
                </div>
                <div class="form-group">
                    <label>Descrição</label>
                    <input type="text" id="channelDescription">
                </div>
                <div class="form-group">
                    <label>Plano</label>
                    <select id="channelPlan" required>
                        <option value="">Selecione...</option>
                        <option value="CF VIP - FATOS DA BOLSA 1">CF VIP - FATOS DA BOLSA 1</option>
                        <option value="CF VIP - FATOS DA BOLSA 2">CF VIP - FATOS DA BOLSA 2</option>
                        <option value="CF VIP - FATOS DA BOLSA 3">CF VIP - FATOS DA BOLSA 3</option>
                        <option value="Close Friends LITE">Close Friends LITE</option>
                        <option value="Projeto Renda Passiva">Projeto Renda Passiva</option>
                        <option value="all">Todos os Planos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ordem</label>
                    <input type="number" id="channelOrder" value="0">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="channelActive">
                        <option value="true">Ativo</option>
                        <option value="false">Inativo</option>
                    </select>
                </div>
                <div class="button-row">
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeChannelModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Administradores -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <h2 id="adminModalTitle">Novo Administrador</h2>
            <div id="adminModalAlert" class="alert"></div>
            <form id="adminForm">
                <input type="hidden" id="adminId">
                <div class="form-group">
                    <label>Usuário</label>
                    <input type="text" id="adminUsername" placeholder="usuario" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="adminPassword" placeholder="Senha (mínimo 8 caracteres)" required autocomplete="new-password">
                </div>
                <div class="button-row">
                    <button type="submit" class="btn btn-primary">Salvar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeAdminModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="admin.js"></script>

<!-- Modal: Importar CSV -->
<div id="importModal" class="modal">
    <div class="modal-content">
        <h2>📂 Importar Assinantes em Massa</h2>
        <div id="importAlert" class="alert"></div>
        
        <div class="modal-info">
            <h3>📋 Instruções:</h3>
            <ol>
                <li>Baixe o modelo CSV clicando em "Baixar Modelo"</li>
                <li>Preencha com os dados dos assinantes</li>
                <li>Colunas obrigatórias: <strong>nome, email, telefone, plano</strong></li>
                <li>Telefone sem formatação (ex: 11999999999)</li>
                <li>Selecione o arquivo e clique em "Importar"</li>
            </ol>
        </div>

        <div class="form-group">
            <label>Arquivo CSV</label>
            <input type="file" id="csvFile" accept=".csv" class="file-input">
        </div>

        <div id="importPreview" class="modal-section" style="display: none;">
            <h3>📊 Preview (primeiras 5 linhas):</h3>
            <div id="previewTable" class="preview-table"></div>
        </div>

        <div id="importResults" class="modal-section" style="display: none;">
            <h3>✅ Resultados da Importação:</h3>
            <div id="resultsContent" class="results-content"></div>
        </div>

        <div class="button-row">
            <button class="btn btn-primary" onclick="processImport()" id="importBtn">Importar</button>
            <button type="button" class="btn btn-secondary" onclick="closeImportModal()">Fechar</button>
        </div>
    </div>
</div>

</body>
</html>
